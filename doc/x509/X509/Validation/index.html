<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Validation (x509.X509.Validation)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">x509</a> &#x00BB; <a href="../index.html">X509</a> &#x00BB; Validation</nav><header class="odoc-preamble"><h1>Module <code><span>X509.Validation</span></code></h1><p>Chain Validation.</p><p>A chain of pairwise signed X.509 certificates is sent to the endpoint, which use these to authenticate the other endpoint. Usually a set of trust anchors is configured on the endpoint, and the chain needs to be rooted in one of the trust anchors. In reality, chains may be incomplete or reversed, and there can be multiple paths from the leaf certificate to a trust anchor.</p><p>RFC 5280 specifies a <a href="https://tools.ietf.org/html/rfc5280#section-6">path validation</a> algorithm for authenticating chains, but this does not handle multiple possible paths. <a href="https://tools.ietf.org/html/rfc4158">RFC 4158</a> describes possible path building strategies.</p><p>This module provides path building, chain of trust verification, trust anchor (certificate authority) validation, and validation via a fingerprint list (for a trust on first use implementation).</p></header><nav class="odoc-toc"><ul><li><a href="#certificate-authorities">Certificate Authorities</a></li><li><a href="#chain-of-trust-verification">Chain of trust verification</a></li><li><a href="#fingerprint-verification">Fingerprint verification</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-signature_error"><a href="#type-signature_error" class="anchor"></a><code><span><span class="keyword">type</span> signature_error</span><span> = </span><span>[ </span></code><ol><li id="type-signature_error.Bad_signature" class="def variant constructor anchored"><a href="#type-signature_error.Bad_signature" class="anchor"></a><code><span>| </span><span>`Bad_signature <span class="keyword">of</span> <a href="../Distinguished_name/index.html#type-t">Distinguished_name.t</a> * string</span></code></li><li id="type-signature_error.Bad_encoding" class="def variant constructor anchored"><a href="#type-signature_error.Bad_encoding" class="anchor"></a><code><span>| </span><span>`Bad_encoding <span class="keyword">of</span> <a href="../Distinguished_name/index.html#type-t">Distinguished_name.t</a> * string * string</span></code></li><li id="type-signature_error.Hash_not_allowed" class="def variant constructor anchored"><a href="#type-signature_error.Hash_not_allowed" class="anchor"></a><code><span>| </span><span>`Hash_not_allowed <span class="keyword">of</span>
  <a href="../Distinguished_name/index.html#type-t">Distinguished_name.t</a>
  * <span>[ `MD5 <span>| `SHA1</span> <span>| `SHA224</span> <span>| `SHA256</span> <span>| `SHA384</span> <span>| `SHA512</span> ]</span></span></code></li><li id="type-signature_error.Unsupported_keytype" class="def variant constructor anchored"><a href="#type-signature_error.Unsupported_keytype" class="anchor"></a><code><span>| </span><span>`Unsupported_keytype <span class="keyword">of</span> <a href="../Distinguished_name/index.html#type-t">Distinguished_name.t</a> * <a href="../Public_key/index.html#type-t">Public_key.t</a></span></code></li><li id="type-signature_error.Unsupported_algorithm" class="def variant constructor anchored"><a href="#type-signature_error.Unsupported_algorithm" class="anchor"></a><code><span>| </span><span>`Unsupported_algorithm <span class="keyword">of</span> <a href="../Distinguished_name/index.html#type-t">Distinguished_name.t</a> * string</span></code></li><li id="type-signature_error.Msg" class="def variant constructor anchored"><a href="#type-signature_error.Msg" class="anchor"></a><code><span>| </span><span>`Msg <span class="keyword">of</span> string</span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>The type of signature verification errors.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_signature_error"><a href="#val-pp_signature_error" class="anchor"></a><code><span><span class="keyword">val</span> pp_signature_error : <span><a href="#type-signature_error">signature_error</a> <span class="xref-unresolved">Fmt</span>.t</span></span></code></div><div class="spec-doc"><p><code>pp_signature_error ppf sige</code> pretty-prints the signature error <code>sige</code> on <code>ppf</code>.</p></div></div><h2 id="certificate-authorities"><a href="#certificate-authorities" class="anchor"></a>Certificate Authorities</h2><div class="odoc-spec"><div class="spec type anchored" id="type-ca_error"><a href="#type-ca_error" class="anchor"></a><code><span><span class="keyword">type</span> ca_error</span><span> = </span><span>[ </span></code><ol><li id="type-ca_error.signature_error" class="def variant type anchored"><a href="#type-ca_error.signature_error" class="anchor"></a><code><span>| </span><span><a href="#type-signature_error">signature_error</a></span></code></li><li id="type-ca_error.CAIssuerSubjectMismatch" class="def variant constructor anchored"><a href="#type-ca_error.CAIssuerSubjectMismatch" class="anchor"></a><code><span>| </span><span>`CAIssuerSubjectMismatch <span class="keyword">of</span> <a href="../Certificate/index.html#type-t">Certificate.t</a></span></code></li><li id="type-ca_error.CAInvalidVersion" class="def variant constructor anchored"><a href="#type-ca_error.CAInvalidVersion" class="anchor"></a><code><span>| </span><span>`CAInvalidVersion <span class="keyword">of</span> <a href="../Certificate/index.html#type-t">Certificate.t</a></span></code></li><li id="type-ca_error.CACertificateExpired" class="def variant constructor anchored"><a href="#type-ca_error.CACertificateExpired" class="anchor"></a><code><span>| </span><span>`CACertificateExpired <span class="keyword">of</span> <a href="../Certificate/index.html#type-t">Certificate.t</a> * <span><span class="xref-unresolved">Ptime</span>.t option</span></span></code></li><li id="type-ca_error.CAInvalidExtensions" class="def variant constructor anchored"><a href="#type-ca_error.CAInvalidExtensions" class="anchor"></a><code><span>| </span><span>`CAInvalidExtensions <span class="keyword">of</span> <a href="../Certificate/index.html#type-t">Certificate.t</a></span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>The polymorphic variant of possible certificate authorities failures.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_ca_error"><a href="#val-pp_ca_error" class="anchor"></a><code><span><span class="keyword">val</span> pp_ca_error : <span><a href="#type-ca_error">ca_error</a> <span class="xref-unresolved">Fmt</span>.t</span></span></code></div><div class="spec-doc"><p><code>pp_ca_error ppf ca_error</code> pretty-prints the CA error <code>ca_error</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-valid_ca"><a href="#val-valid_ca" class="anchor"></a><code><span><span class="keyword">val</span> valid_ca : 
  <span><span class="optlabel">?allowed_hashes</span>:<span><span class="xref-unresolved">Digestif</span>.hash' list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?time</span>:<span class="xref-unresolved">Ptime</span>.t <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Certificate/index.html#type-t">Certificate.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(unit, <span>[&gt; <a href="#type-ca_error">ca_error</a> ]</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span></span></code></div><div class="spec-doc"><p><code>valid_ca ~allowed_hashes ~time certificate</code> is <code>result</code>, which is <code>Ok ()</code> if the given certificate is self-signed with any hash algorithm of <code>hash_allowlist</code> (defaults to any hash), it is valid at <code>time</code>, its extensions are not present (if X.509 version 1 certificate), or are appropriate for a CA (BasicConstraints is present and true, KeyUsage extension contains keyCertSign).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-valid_cas"><a href="#val-valid_cas" class="anchor"></a><code><span><span class="keyword">val</span> valid_cas : 
  <span><span class="optlabel">?allowed_hashes</span>:<span><span class="xref-unresolved">Digestif</span>.hash' list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?time</span>:<span class="xref-unresolved">Ptime</span>.t <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Certificate/index.html#type-t">Certificate.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Certificate/index.html#type-t">Certificate.t</a> list</span></span></code></div><div class="spec-doc"><p><code>valid_cas ~allowed_hashes ~time certificates</code> is <code>valid_certificates</code>, only those certificates which pass the <a href="#val-valid_ca"><code>valid_ca</code></a> check.</p></div></div><h2 id="chain-of-trust-verification"><a href="#chain-of-trust-verification" class="anchor"></a>Chain of trust verification</h2><div class="odoc-spec"><div class="spec type anchored" id="type-leaf_validation_error"><a href="#type-leaf_validation_error" class="anchor"></a><code><span><span class="keyword">type</span> leaf_validation_error</span><span> = </span><span>[ </span></code><ol><li id="type-leaf_validation_error.LeafCertificateExpired" class="def variant constructor anchored"><a href="#type-leaf_validation_error.LeafCertificateExpired" class="anchor"></a><code><span>| </span><span>`LeafCertificateExpired <span class="keyword">of</span> <a href="../Certificate/index.html#type-t">Certificate.t</a> * <span><span class="xref-unresolved">Ptime</span>.t option</span></span></code></li><li id="type-leaf_validation_error.LeafInvalidIP" class="def variant constructor anchored"><a href="#type-leaf_validation_error.LeafInvalidIP" class="anchor"></a><code><span>| </span><span>`LeafInvalidIP <span class="keyword">of</span> <a href="../Certificate/index.html#type-t">Certificate.t</a> * <span><span class="xref-unresolved">Ipaddr</span>.t option</span></span></code></li><li id="type-leaf_validation_error.LeafInvalidName" class="def variant constructor anchored"><a href="#type-leaf_validation_error.LeafInvalidName" class="anchor"></a><code><span>| </span><span>`LeafInvalidName <span class="keyword">of</span> <a href="../Certificate/index.html#type-t">Certificate.t</a> * <span><span><span>[ `host ]</span> <span class="xref-unresolved">Domain_name</span>.t</span> option</span></span></code></li><li id="type-leaf_validation_error.LeafInvalidVersion" class="def variant constructor anchored"><a href="#type-leaf_validation_error.LeafInvalidVersion" class="anchor"></a><code><span>| </span><span>`LeafInvalidVersion <span class="keyword">of</span> <a href="../Certificate/index.html#type-t">Certificate.t</a></span></code></li><li id="type-leaf_validation_error.LeafInvalidExtensions" class="def variant constructor anchored"><a href="#type-leaf_validation_error.LeafInvalidExtensions" class="anchor"></a><code><span>| </span><span>`LeafInvalidExtensions <span class="keyword">of</span> <a href="../Certificate/index.html#type-t">Certificate.t</a></span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>The polymorphic variant of a leaf certificate validation error.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-chain_validation_error"><a href="#type-chain_validation_error" class="anchor"></a><code><span><span class="keyword">type</span> chain_validation_error</span><span> = </span><span>[ </span></code><ol><li id="type-chain_validation_error.IntermediateInvalidExtensions" class="def variant constructor anchored"><a href="#type-chain_validation_error.IntermediateInvalidExtensions" class="anchor"></a><code><span>| </span><span>`IntermediateInvalidExtensions <span class="keyword">of</span> <a href="../Certificate/index.html#type-t">Certificate.t</a></span></code></li><li id="type-chain_validation_error.IntermediateCertificateExpired" class="def variant constructor anchored"><a href="#type-chain_validation_error.IntermediateCertificateExpired" class="anchor"></a><code><span>| </span><span>`IntermediateCertificateExpired <span class="keyword">of</span> <a href="../Certificate/index.html#type-t">Certificate.t</a> * <span><span class="xref-unresolved">Ptime</span>.t option</span></span></code></li><li id="type-chain_validation_error.IntermediateInvalidVersion" class="def variant constructor anchored"><a href="#type-chain_validation_error.IntermediateInvalidVersion" class="anchor"></a><code><span>| </span><span>`IntermediateInvalidVersion <span class="keyword">of</span> <a href="../Certificate/index.html#type-t">Certificate.t</a></span></code></li><li id="type-chain_validation_error.ChainIssuerSubjectMismatch" class="def variant constructor anchored"><a href="#type-chain_validation_error.ChainIssuerSubjectMismatch" class="anchor"></a><code><span>| </span><span>`ChainIssuerSubjectMismatch <span class="keyword">of</span> <a href="../Certificate/index.html#type-t">Certificate.t</a> * <a href="../Certificate/index.html#type-t">Certificate.t</a></span></code></li><li id="type-chain_validation_error.ChainAuthorityKeyIdSubjectKeyIdMismatch" class="def variant constructor anchored"><a href="#type-chain_validation_error.ChainAuthorityKeyIdSubjectKeyIdMismatch" class="anchor"></a><code><span>| </span><span>`ChainAuthorityKeyIdSubjectKeyIdMismatch <span class="keyword">of</span> <a href="../Certificate/index.html#type-t">Certificate.t</a> * <a href="../Certificate/index.html#type-t">Certificate.t</a></span></code></li><li id="type-chain_validation_error.ChainInvalidPathlen" class="def variant constructor anchored"><a href="#type-chain_validation_error.ChainInvalidPathlen" class="anchor"></a><code><span>| </span><span>`ChainInvalidPathlen <span class="keyword">of</span> <a href="../Certificate/index.html#type-t">Certificate.t</a> * int</span></code></li><li id="type-chain_validation_error.EmptyCertificateChain" class="def variant constructor anchored"><a href="#type-chain_validation_error.EmptyCertificateChain" class="anchor"></a><code><span>| </span><span>`EmptyCertificateChain</span></code></li><li id="type-chain_validation_error.NoTrustAnchor" class="def variant constructor anchored"><a href="#type-chain_validation_error.NoTrustAnchor" class="anchor"></a><code><span>| </span><span>`NoTrustAnchor <span class="keyword">of</span> <a href="../Certificate/index.html#type-t">Certificate.t</a></span></code></li><li id="type-chain_validation_error.Revoked" class="def variant constructor anchored"><a href="#type-chain_validation_error.Revoked" class="anchor"></a><code><span>| </span><span>`Revoked <span class="keyword">of</span> <a href="../Certificate/index.html#type-t">Certificate.t</a></span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>The polymorphic variant of a chain validation error.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-build_paths"><a href="#val-build_paths" class="anchor"></a><code><span><span class="keyword">val</span> build_paths : 
  <span><a href="../Certificate/index.html#type-t">Certificate.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Certificate/index.html#type-t">Certificate.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Certificate/index.html#type-t">Certificate.t</a> list</span> list</span></span></code></div><div class="spec-doc"><p><code>build_paths server rest</code> is <code>paths</code>, which are all possible certificate paths starting with <code>server</code>. These chains (C1..Cn) fulfill the predicate that each certificate Cn is issued by the next one in the chain (C(n+1)): the issuer of Cn matches the subject of C(n+1). This is as described in <a href="https://tools.ietf.org/html/rfc4158">RFC 4158</a>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-chain_error"><a href="#type-chain_error" class="anchor"></a><code><span><span class="keyword">type</span> chain_error</span><span> = </span><span>[ </span></code><ol><li id="type-chain_error.signature_error" class="def variant type anchored"><a href="#type-chain_error.signature_error" class="anchor"></a><code><span>| </span><span><a href="#type-signature_error">signature_error</a></span></code></li><li id="type-chain_error.leaf_validation_error" class="def variant type anchored"><a href="#type-chain_error.leaf_validation_error" class="anchor"></a><code><span>| </span><span><a href="#type-leaf_validation_error">leaf_validation_error</a></span></code></li><li id="type-chain_error.chain_validation_error" class="def variant type anchored"><a href="#type-chain_error.chain_validation_error" class="anchor"></a><code><span>| </span><span><a href="#type-chain_validation_error">chain_validation_error</a></span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>The polymorphic variant of a chain validation error: either the leaf certificate is problematic, or the chain itself.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_chain_error"><a href="#val-pp_chain_error" class="anchor"></a><code><span><span class="keyword">val</span> pp_chain_error : <span><a href="#type-chain_error">chain_error</a> <span class="xref-unresolved">Fmt</span>.t</span></span></code></div><div class="spec-doc"><p><code>pp_chain_error ppf chain_error</code> pretty-prints the <code>chain_error</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-verify_chain"><a href="#val-verify_chain" class="anchor"></a><code><span><span class="keyword">val</span> verify_chain : 
  <span><span class="optlabel">?ip</span>:<span class="xref-unresolved">Ipaddr</span>.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">host</span>:<span><span><span>[ `host ]</span> <span class="xref-unresolved">Domain_name</span>.t</span> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">time</span>:<span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Ptime</span>.t option</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?revoked</span>:<span>(<span><span class="label">issuer</span>:<a href="../Certificate/index.html#type-t">Certificate.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">cert</span>:<a href="../Certificate/index.html#type-t">Certificate.t</a> <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?allowed_hashes</span>:<span><span class="xref-unresolved">Digestif</span>.hash' list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">anchors</span>:<span><a href="../Certificate/index.html#type-t">Certificate.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Certificate/index.html#type-t">Certificate.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../Certificate/index.html#type-t">Certificate.t</a>, <span>[&gt; <a href="#type-chain_error">chain_error</a> ]</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span></span></code></div><div class="spec-doc"><p><code>verify_chain ~ip ~host ~time ~revoked ~allowed_hashes ~anchors chain</code> is <code>result</code>, either <code>Ok</code> and the trust anchor used to verify the chain, or <code>Error</code> and the chain error. RFC 5280 describes the implemented <a href="https://tools.ietf.org/html/rfc5280#section-6.1">path validation</a> algorithm: The validity period of the given certificates is checked against the <code>time</code>. The signature algorithm must be present in <code>allowed_hashes</code> (defaults to SHA-2). The X509v3 extensions of the <code>chain</code> are checked, then a chain of trust from <code>anchors</code> to the server certificate is validated. The path length constraints are checked. The server certificate is checked to contain the given <code>host</code>, using <a href="../Certificate/index.html#val-hostnames"><code>Certificate.hostnames</code></a>. If <code>ip</code> is specified, the certificate is checked to contain the given <code>ip</code>, using <a href="../Certificate/index.html#val-ips"><code>Certificate.ips</code></a>. The returned certificate is the root of the chain, a member of the given list of <code>anchors</code>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-fingerprint_validation_error"><a href="#type-fingerprint_validation_error" class="anchor"></a><code><span><span class="keyword">type</span> fingerprint_validation_error</span><span> = </span><span>[ </span></code><ol><li id="type-fingerprint_validation_error.InvalidFingerprint" class="def variant constructor anchored"><a href="#type-fingerprint_validation_error.InvalidFingerprint" class="anchor"></a><code><span>| </span><span>`InvalidFingerprint <span class="keyword">of</span> <a href="../Certificate/index.html#type-t">Certificate.t</a> * string * string</span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>The polymorphic variant of a fingerprint validation error.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-validation_error"><a href="#type-validation_error" class="anchor"></a><code><span><span class="keyword">type</span> validation_error</span><span> = </span><span>[ </span></code><ol><li id="type-validation_error.signature_error" class="def variant type anchored"><a href="#type-validation_error.signature_error" class="anchor"></a><code><span>| </span><span><a href="#type-signature_error">signature_error</a></span></code></li><li id="type-validation_error.leaf_validation_error" class="def variant type anchored"><a href="#type-validation_error.leaf_validation_error" class="anchor"></a><code><span>| </span><span><a href="#type-leaf_validation_error">leaf_validation_error</a></span></code></li><li id="type-validation_error.fingerprint_validation_error" class="def variant type anchored"><a href="#type-validation_error.fingerprint_validation_error" class="anchor"></a><code><span>| </span><span><a href="#type-fingerprint_validation_error">fingerprint_validation_error</a></span></code></li><li id="type-validation_error.EmptyCertificateChain" class="def variant constructor anchored"><a href="#type-validation_error.EmptyCertificateChain" class="anchor"></a><code><span>| </span><span>`EmptyCertificateChain</span></code></li><li id="type-validation_error.InvalidChain" class="def variant constructor anchored"><a href="#type-validation_error.InvalidChain" class="anchor"></a><code><span>| </span><span>`InvalidChain</span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>The polymorphic variant of validation errors.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_validation_error"><a href="#val-pp_validation_error" class="anchor"></a><code><span><span class="keyword">val</span> pp_validation_error : <span><a href="#type-validation_error">validation_error</a> <span class="xref-unresolved">Fmt</span>.t</span></span></code></div><div class="spec-doc"><p><code>pp_validation_error ppf validation_error</code> pretty-prints the <code>validation_error</code>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-r"><a href="#type-r" class="anchor"></a><code><span><span class="keyword">type</span> r</span><span> =
  <span><span>(<span><span>(<span><a href="../Certificate/index.html#type-t">Certificate.t</a> list</span> * <a href="../Certificate/index.html#type-t">Certificate.t</a>)</span> option</span>, <a href="#type-validation_error">validation_error</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-verify_chain_of_trust"><a href="#val-verify_chain_of_trust" class="anchor"></a><code><span><span class="keyword">val</span> verify_chain_of_trust : 
  <span><span class="optlabel">?ip</span>:<span class="xref-unresolved">Ipaddr</span>.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">host</span>:<span><span><span>[ `host ]</span> <span class="xref-unresolved">Domain_name</span>.t</span> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">time</span>:<span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Ptime</span>.t option</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?revoked</span>:<span>(<span><span class="label">issuer</span>:<a href="../Certificate/index.html#type-t">Certificate.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">cert</span>:<a href="../Certificate/index.html#type-t">Certificate.t</a> <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?allowed_hashes</span>:<span><span class="xref-unresolved">Digestif</span>.hash' list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">anchors</span>:<span><a href="../Certificate/index.html#type-t">Certificate.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Certificate/index.html#type-t">Certificate.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-r">r</a></span></code></div><div class="spec-doc"><p><code>verify_chain_of_trust ~ip ~host ~time ~revoked ~allowed_hashes ~anchors certificates</code> is <code>result</code>. First, all possible paths are constructed using the <a href="#val-build_paths"><code>build_paths</code></a> function, the first certificate of the chain is verified to be a valid leaf certificate (no BasicConstraints extension) and contains the given <code>host</code> (using <a href="../Certificate/index.html#val-hostnames"><code>Certificate.hostnames</code></a>) or <code>ip</code> if specified (using <a href="../Certificate/index.html#val-ips"><code>Certificate.ips</code></a>; if some path is valid, using <a href="#val-verify_chain"><code>verify_chain</code></a>, the result will be <code>Ok</code> and contain the actual certificate chain and the trust anchor.</p></div></div><h2 id="fingerprint-verification"><a href="#fingerprint-verification" class="anchor"></a>Fingerprint verification</h2><div class="odoc-spec"><div class="spec value anchored" id="val-trust_key_fingerprint"><a href="#val-trust_key_fingerprint" class="anchor"></a><code><span><span class="keyword">val</span> trust_key_fingerprint : 
  <span><span class="optlabel">?ip</span>:<span class="xref-unresolved">Ipaddr</span>.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">host</span>:<span><span><span>[ `host ]</span> <span class="xref-unresolved">Domain_name</span>.t</span> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">time</span>:<span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Ptime</span>.t option</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">hash</span>:<span class="xref-unresolved">Digestif</span>.hash' <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">fingerprint</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Certificate/index.html#type-t">Certificate.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-r">r</a></span></code></div><div class="spec-doc"><p><code>trust_key_fingerprint ~ip ~host ~time ~hash ~fingerprint certificates</code> is <code>result</code>, the first element of <code>certificates</code> is verified against the given <code>fingerprint</code> using <a href="../Public_key/index.html#val-fingerprint"><code>Public_key.fingerprint</code></a>. If <code>time</code> is provided, the certificate has to be valid at the given timestamp. If <code>host</code> is provided, the certificate is checked for the given <code>host</code> (using <a href="../Certificate/index.html#val-hostnames"><code>Certificate.hostnames</code></a>). If <code>ip</code> is provided, the certificate is checked to include this IP address (using <a href="../Certificate/index.html#val-ips"><code>Certificate.ips</code></a>).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-trust_cert_fingerprint"><a href="#val-trust_cert_fingerprint" class="anchor"></a><code><span><span class="keyword">val</span> trust_cert_fingerprint : 
  <span><span class="optlabel">?ip</span>:<span class="xref-unresolved">Ipaddr</span>.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">host</span>:<span><span><span>[ `host ]</span> <span class="xref-unresolved">Domain_name</span>.t</span> option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">time</span>:<span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Ptime</span>.t option</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">hash</span>:<span class="xref-unresolved">Digestif</span>.hash' <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">fingerprint</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Certificate/index.html#type-t">Certificate.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-r">r</a></span></code></div><div class="spec-doc"><p><code>trust_cert_fingerprint host ~time ~hash ~fingerprint certificates</code> is <code>result</code>, the first element of <code>certificates</code> is verified to match the given <code>fingerprint</code> using <a href="../Certificate/index.html#val-fingerprint"><code>Certificate.fingerprint</code></a>. If <code>time</code> is provided, the certificate is checked to be valid in at the given timestamp. If <code>host</code> is provided, the certificate is checked for the given <code>host</code> (using <a href="../Certificate/index.html#val-hostnames"><code>Certificate.hostnames</code></a>). If <code>ip</code> is provided, the certificate is checked to include this IP address (using <a href="../Certificate/index.html#val-ips"><code>Certificate.ips</code></a>). Note that <a href="#val-trust_key_fingerprint" title="trust_key_fingerprint">public key pinning</a> has <a href="https://www.imperialviolet.org/2011/05/04/pinning.html">advantages</a> over certificate pinning.</p></div></div></div></body></html>
